<!DOCTYPE html>
<html>
  <head>
    <title>Rhythm Perception Experiment</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.3"></script>

    <style>
      /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
      body {
        font-family: 'Noto Sans KR', sans-serif; /* í•œê¸€ í°íŠ¸ ê¶Œì¥ */
      }
      .jspsych-content {
        max-width: 800px; /* ì „ì²´ í­ ì œí•œ */
        margin: auto;
      }

      /* ì§ˆë¬¸ ë°•ìŠ¤ (ì¹´ë“œ í˜•íƒœ) ë””ìì¸ */
      .question-box {
        background: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 25px; /* ì§ˆë¬¸ ì‚¬ì´ì˜ ê°„ê²© */
        box-shadow: 0 4px 6px rgba(0,0,0,0.05); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        text-align: left;
      }

      .question-text {
        font-size: 1.1em;
        font-weight: bold;
        color: #333;
        margin-bottom: 20px;
        display: block;
      }

      /* ìŠ¬ë¼ì´ë” ì˜ì—­ */
      .slider-wrapper {
        padding: 0 10px;
      }

      input[type=range] {
        width: 100%;
        cursor: pointer;
        margin: 15px 0;
      }

      /* ìŠ¬ë¼ì´ë” ë¼ë²¨ (ì–‘ ë ì •ë ¬) */
      .slider-labels {
        display: flex;
        justify-content: space-between;
        font-size: 0.9em;
        color: #666;
      }

      /* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì˜ì—­ */
      .audio-section {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 40px;
        text-align: center;
        border: 1px solid #eee;
      }
    </style>
  </head>
  <body></body>
  <script>

    const jsPsych = initJsPsych({
      on_finish: function() {
        // ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ì €ì¥ (ì˜¨ë¼ì¸ ë°°í¬ ì‹œì—ëŠ” ì‘ë™í•˜ì§€ ì•ŠìŒ)
        jsPsych.data.get().localSave('csv', 'my_experiment_data.csv');
      }
    });

    var timeline = [];

    // 1. ì‹¤í—˜ ìê·¹ ëª©ë¡ (ì—…ë°ì´íŠ¸ ë¨)
    var audio_stimuli = [
      { stimulus: "stimuli/02_-1.mp3", id: "02_-1" },
      { stimulus: "stimuli/32_shigimsae.mp3", id: "32_shigimsae" }
    ];

    // 2. Preload: ì˜¤ë””ì˜¤ íŒŒì¼ ë¯¸ë¦¬ ë¡œë”©
    var preload = {
      type: jsPsychPreload,
      audio: audio_stimuli.map(s => s.stimulus)
    };
    timeline.push(preload);

    // 3. ì•ˆë‚´ë¬¸
    var instructions = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `
        <div style="text-align: left; background: #fff; padding: 20px; border-radius:8px; border: 1px solid #ddd;">
          <h3>ì‹¤í—˜ ì•ˆë‚´</h3>
          <p>ë³¸ ì‹¤í—˜ì— ì°¸ì—¬í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
          <p>1. ê° ì‹œí–‰ë§ˆë‹¤ <strong>ì¬ìƒ ë²„íŠ¼[â–¶]</strong>ì„ ëˆŒëŸ¬ ë¦¬ë“¬ì„ ë“¤ì–´ì£¼ì„¸ìš”.</p>
          <p>2. ë¦¬ë“¬ì€ ì›í•˜ëŠ” ë§Œí¼ <strong>ë°˜ë³µí•´ì„œ ì²­ì·¨</strong>í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <p>3. ì²­ì·¨ í›„, ë‘ ê°€ì§€ ì§ˆë¬¸ì— ëŒ€í•´ ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬ ì‘ë‹µí•´ ì£¼ì„¸ìš”.</p>
          <p>ì¤€ë¹„ê°€ ë˜ì…¨ë‹¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•´ ì£¼ì„¸ìš”.</p>
        </div>
      `,
      choices: ['ì‹¤í—˜ ì‹œì‘í•˜ê¸°']
    };
    timeline.push(instructions);

    // 4. ë©”ì¸ ì‹¤í—˜ íŠ¸ë¼ì´ì–¼ (ì˜¤ë””ì˜¤ + ìŠ¬ë¼ì´ë” 2ê°œ)
    var trial = {
      type: jsPsychSurveyHtmlForm,
      preamble: function() {
        var current_audio = jsPsych.timelineVariable('stimulus');
        return `
          <div class="audio-section">
            <p style="margin-bottom:10px;">ğŸ§ ì•„ë˜ ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¦¬ë“¬ì„ ë“¤ì–´ë³´ì„¸ìš”</p>
            <audio controls controlsList="nodownload" src="${current_audio}" style="width: 100%; max-width: 400px;"></audio>
          </div>
        `;
      },
      html: `
        <div class="question-box">
          <label class="question-text" for="groove">1. ì´ ì¥ë‹¨ì´ ì–¼ë§ˆë‚˜ ëª¸ì„ ì›€ì§ì´ê³  ì‹¶ê²Œ í–ˆë‚˜ìš”?</label>
          
          <div class="slider-wrapper">
            <input type="range" id="groove" name="groove_rating" min="0" max="100" value="50" step="1">
            
            <div class="slider-labels">
              <span style="text-align: left;">0<br>(ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤)</span>
              <span style="text-align: right;">100<br>(ë§¤ìš° ê·¸ë ‡ë‹¤)</span>
            </div>
          </div>
        </div>

        <div class="question-box">
          <label class="question-text" for="pleasure">2. ì´ ì¥ë‹¨ì„ ë“¤ìœ¼ë©° ì–¼ë§ˆë‚˜ ì¦ê±°ì›€ì„ ëŠê¼ˆìŠµë‹ˆê¹Œ?</label>
          
          <div class="slider-wrapper">
            <input type="range" id="pleasure" name="pleasure_rating" min="0" max="100" value="50" step="1">
            
            <div class="slider-labels">
              <span style="text-align: left;">0<br>(ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤)</span>
              <span style="text-align: right;">100<br>(ë§¤ìš° ê·¸ë ‡ë‹¤)</span>
            </div>
          </div>
        </div>
      `,
      button_label: 'ë‹¤ìŒ',
      data: {
        stim_id: jsPsych.timelineVariable('id') // ë°ì´í„°ì— íŒŒì¼ ID ì €ì¥
      }
    };

    var test_procedure = {
      timeline: [trial],
      timeline_variables: audio_stimuli,
      randomize_order: true // ìê·¹ ì œì‹œ ìˆœì„œ ë¬´ì‘ìœ„
    };
    timeline.push(test_procedure);

    // 5. ì¢…ë£Œ í™”ë©´
    var end_screen = {
      type: jsPsychHtmlButtonResponse,
      stimulus: `
        <h3>ì‹¤í—˜ ì¢…ë£Œ</h3>
        <p>ëª¨ë“  ê³¼ì •ì´ ëë‚¬ìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.</p>
        <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°ì´í„°ê°€ ì €ì¥ë©ë‹ˆë‹¤.</p>
      `,
      choices: ['ë°ì´í„° ì €ì¥ ë° ì¢…ë£Œ']
    };
    timeline.push(end_screen);

    // íƒ€ì„ë¼ì¸ ì‹¤í–‰
    jsPsych.run(timeline);

  </script>
</html>
