<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groove & Rhythm Perception Experiment (A)</title>
    
    <!-- jsPsych ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° í”ŒëŸ¬ê·¸ì¸ ë¡œë“œ (unpkg ì‚¬ìš©) -->
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.3"></script>
    
    <!-- [ì¶”ê°€ë¨] DataPipe í”ŒëŸ¬ê·¸ì¸ -->
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    
    <!-- jsPsych ìŠ¤íƒ€ì¼ì‹œíŠ¸ -->
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    
    <style>
        /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            background-color: #f0f2f5;
            color: #333;
        }
        .jspsych-content {
            max-width: 1000px;
            margin: auto;
            padding-bottom: 50px;
        }

        /* ì§ˆë¬¸ ë°•ìŠ¤ ë””ìì¸ */
        .question-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: left;
        }

        .question-text {
            font-size: 1.1em;
            font-weight: bold;
            color: #222;
            margin-bottom: 20px;
            display: block;
        }

        .question-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        /* --- PDF Viewer & Consent Styles (Updated) --- */
        .pdf-box {
            width: 100%;
            height: 60vh; 
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: auto; /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ */
            margin: 12px 0 8px;
        }
        .pdf-box iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .consent-text {
            font-size: 13px;
            margin-bottom: 8px;
            line-height: 1.6;
            color: #333;
        }
        .consent-section-title {
            font-weight: 600;
            margin: 16px 0 4px;
            font-size: 14px;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        .consent-input-row {
            margin: 6px 0;
            font-size: 13px;
        }
        .consent-input-row label {
            display: inline-block;
            min-width: 190px;
            font-weight: bold;
        }
        .consent-input-row input[type="text"] {
            width: 60%;
            max-width: 360px;
            padding: 4px 6px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        /* ë°˜ì‘í˜• ì²˜ë¦¬ */
        @media (max-width: 600px) {
            .consent-input-row label {
                display: block;
                margin-bottom: 2px;
            }
            .consent-input-row input[type="text"] {
                width: 95%;
                max-width: 100%;
            }
        }

        /* --- Page 2: Eligibility Check Styles --- */
        .jspsych-survey-multi-choice-question {
            text-align: center;
            margin-top: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .jspsych-survey-multi-choice-question:last-child {
            border-bottom: none;
        }

        .jspsych-survey-multi-choice-text {
            text-align: left;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .jspsych-survey-multi-choice-option {
            display: inline-flex !important; 
            align-items: center;
            justify-content: center;
            margin: 0 40px !important;
        }
        
        .jspsych-survey-multi-choice-option input {
            margin-right: 8px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .jspsych-survey-multi-choice-option label {
            cursor: pointer;
            font-size: 1.05em;
        }

        /* --- Custom Likert Style (Page 4) --- */
        .likert-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-top: 10px;
            width: 100%;
        }
        .likert-label-side {
            font-size: 0.9em;
            font-weight: bold;
            color: #555;
            white-space: nowrap; 
            margin-bottom: 5px; 
            width: 140px; 
            flex-shrink: 0; 
            text-align: center; 
        }
        .likert-options-group {
            display: flex;
            justify-content: space-between;
            flex-grow: 1; 
            margin: 0 10px;
        }
        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 100%; 
        }
        .likert-num {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .likert-option input[type="radio"] {
            margin: 0;
            width: 20px; 
            height: 20px;
            cursor: pointer;
        }

        /* --- Slider Style (Trials) --- */
        .slider-wrapper {
            padding: 0 40px; 
            margin-bottom: 30px; 
            position: relative; 
        }
        input[type=range] {
            width: 100%;
            cursor: pointer;
            margin: 15px 0;
            height: 8px;
            background: #e0e0e0;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            display: block;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4a90e2; 
            cursor: pointer;
        }
        .slider-labels-container {
            position: relative;
            width: 100%;
            height: 40px; 
            margin-top: 5px;
        }
        .slider-label-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 0;
            white-space: nowrap; 
            text-align: center;
        }
        .slider-label-left {
            left: 0;
            transform: translateX(-50%);
        }
        .slider-label-right {
            right: 0;
            transform: translateX(50%);
        }
        .slider-num-bold {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
        }

        /* ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì˜ì—­ */
        .audio-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid #ddd;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .progress-text {
            text-align: right;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .small-input { width: 80px; padding: 5px; }
        select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; resize: vertical; width: 100%; box-sizing: border-box;}
    </style>
</head>
<body>
    <div id="jspsych-target"></div>

<script>
    // 1. jsPsych ì´ˆê¸°í™” (ìƒë‹¨ progress bar í™œì„±í™”)
    const jsPsych = initJsPsych({
        show_progress_bar: true
    });

    // [ì¤‘ìš”] DataPipeìš© ëœë¤ ID ìƒì„±
    const subject_id = jsPsych.randomization.randomID(10);
    const filename = `expA_${subject_id}.csv`;
    
    // ë°ì´í„°ì— subject_id ì¶”ê°€ (ëª¨ë“  í–‰ì— ê¸°ë¡ë¨)
    jsPsych.data.addProperties({
        subject_id: subject_id
    });

    // 2. íƒ€ì„ë¼ì¸ ìƒì„±
    var timeline = [];

    // --- ë³¸ ì‹¤í—˜ ìê·¹ ëª©ë¡ (Experiment A) ---
    var main_stimuli = [
        { stimulus: "stimuli/original/01_3_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/04_66_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/07_44_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/10_29_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/13_-1_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/16_-1_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/19_-1_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/22_26_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/25_-1_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/28_39_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/31_51_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/34_48_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/37_54_ori.mp3", type: "original" },
        { stimulus: "stimuli/original/40_67_ori.mp3", type: "original" },
        { stimulus: "stimuli/quantized/03_1_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/06_-1_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/09_19_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/12_-1_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/15_-1_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/18_65_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/21_23_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/24_35_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/27_43_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/30_49_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/33_41_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/36_45_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/quantized/39_60_quantized_velocity82.mp3", type: "quantized" },
        { stimulus: "stimuli/shigimsae/1_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/26_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/33_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/3_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/43_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/48_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/53_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/59_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/shigimsae/65_shigimsae.mp3", type: "shigimsae" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_01_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_04_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_07_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_10_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_13_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_16_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_19_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_22_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_25_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_28_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_31_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_34_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_37_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_40_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_43_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_46_80bpm.mp3", type: "drum" },
        { stimulus: "stimuli/drum_stimuli/jangdan_drum_49_80bpm.mp3", type: "drum" }
    ];

    // ì—°ìŠµ íŒŒì¼ ì œê±°í•˜ê³  ë³¸ ì‹¤í—˜ íŒŒì¼ë§Œ ë¡œë“œ
    var all_audio = main_stimuli.map(a => a.stimulus);

    // 3. Preload
    var preload = {
        type: jsPsychPreload,
        audio: all_audio,
        message: 'ì‹¤í—˜ ë°ì´í„°ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...',
        show_detailed_errors: true,
        continue_after_error: true
    };
    timeline.push(preload);

    // ==========================================
    // [ì¶”ê°€] ë™ì˜ì„œ ë° ì•ˆë‚´ (Consent & Intro)
    // ==========================================

    // 1-0. ì‹œì‘ ì•ˆë‚´ í™”ë©´
    var intro_screen = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <div class="question-box" style="text-align:center;">
                <h1 class="main-title">ë¦¬ë“¬ ë° ê·¸ë£¨ë¸Œ ì§€ê° ì‹¤í—˜ ì•ˆë‚´</h1>
                <div style="text-align:left; margin-top:16px; line-height:1.7;">
                    <p>ì•ˆë…•í•˜ì„¸ìš”! ì‹¤í—˜ì— ê´€ì‹¬ ê°€ì ¸ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ì´ ì‹¤í—˜ì—ì„œëŠ” ë‹¤ì–‘í•œ ë¦¬ë“¬ì„ ë“£ê³ , ê° ë¦¬ë“¬ì— ëŒ€í•œ ëŠë‚Œê³¼ ì§€ê°ì„ í‰ê°€í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
                    <p style="margin-top:10px;">ë³¸ ì‹¤í—˜ì— ì°¸ì—¬í•˜ì‹œê¸° ìœ„í•´ì„œëŠ”, ë‹¤ìŒ ë‘ ê°€ì§€ ë™ì˜ì„œì— ëŒ€í•œ ë‚´ìš©ì„ ì½ê³  ë™ì˜ ì—¬ë¶€ë¥¼ ì„ íƒí•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.</p>
                    <ul style="line-height:1.7;">
                        <li><strong>â‘  ì¸ê°„ëŒ€ìƒ ì—°êµ¬í”¼í—˜ì ë™ì˜ì„œ</strong></li>
                        <li><strong>â‘¡ (ì‚¬ë¡€ë¹„ ì§€ê¸‰ ë“±)ì„ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš© ë™ì˜ì„œ</strong></li>
                    </ul>
                    <p style="margin-top:8px;">
                        ë‘ ë™ì˜ì„œ ëª¨ë‘ì— <strong>ë™ì˜</strong>í•˜ì…”ì•¼ë§Œ ë³¸ í–‰ë™ì‹¤í—˜ì— ì°¸ì—¬í•˜ì‹¤ ìˆ˜ ìˆìœ¼ë©°,<br>
                        ë™ì˜í•˜ì§€ ì•Šìœ¼ì‹œëŠ” ê²½ìš° ì‹¤í—˜ì´ ì¦‰ì‹œ ì¢…ë£Œë©ë‹ˆë‹¤.
                    </p>
                    <p style="margin-top:8px;">
                        ë‹¤ìŒ ë²„íŠ¼ì„ ëˆ„ë¥´ì‹œë©´, ë¨¼ì € â‘  ì¸ê°„ëŒ€ìƒ ì—°êµ¬í”¼í—˜ì ë™ì˜ì„œ(PDF)ë¥¼ í™•ì¸í•˜ì‹  ë’¤<br>
                        ë™ì˜ ì—¬ë¶€ ë° ì„œëª…ì„ ì…ë ¥í•˜ëŠ” í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        `,
        choices: ["ë‹¤ìŒìœ¼ë¡œ (ë™ì˜ì„œ í™•ì¸ ì‹œì‘)"]
    };
    timeline.push(intro_screen);

    // 1-1. ë™ì˜ì„œ 1: ì¸ê°„ëŒ€ìƒ ì—°êµ¬í”¼í—˜ì ë™ì˜ì„œ
    var consent_human = {
        type: jsPsychSurveyHtmlForm,
        preamble: `
            <div class="question-box">
                <h1 class="main-title" style="text-align:center;">ì¸ê°„ëŒ€ìƒ ì—°êµ¬í”¼í—˜ì ë™ì˜ì„œ</h1>
                <p class="consent-text">
                    ë¨¼ì €, ì•„ë˜ì˜ <strong>ì¸ê°„ëŒ€ìƒ ì—°êµ¬í”¼í—˜ì ë™ì˜ì„œ ì „ë¬¸(PDF íŒŒì¼)</strong>ì„ ìŠ¤í¬ë¡¤í•˜ì—¬ ëê¹Œì§€ ì½ì–´ì£¼ì„¸ìš”.
                </p>
                <div class="pdf-box">
                    <iframe src="documents/experiment_consent.pdf"></iframe>
                </div>
                <p class="consent-text" style="font-size:12px; color:#666; text-align:center;">
                    â€» ëª¨ë°”ì¼ì—ì„œ PDFê°€ í•œ í˜ì´ì§€ë§Œ ë³´ì´ê±°ë‚˜ ìŠ¤í¬ë¡¤ì´ ë˜ì§€ ì•Šì„ ê²½ìš°,
                    <a href="documents/experiment_consent.pdf" target="_blank">ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ ìƒˆ íƒ­ì—ì„œ ì „ì²´ ë™ì˜ì„œë¥¼ í™•ì¸</a>í•´ ì£¼ì„¸ìš”.
                </p>
                <p class="consent-text">
                    ì•„ë˜ ë¬¸í•­ë“¤ì€ ë™ì˜ì„œ ì „ë¬¸ì—ì„œ <strong>í”¼í—˜ìì˜ ë™ì˜ê°€ í•„ìš”í•œ í•­ëª©</strong>ì„ ë°œì·Œí•œ ê²ƒì…ë‹ˆë‹¤.<br>
                    ê° í•­ëª©ì„ ì½ê³  í˜„ì¬ ë³¸ì¸ì˜ ì˜ê²¬ì— í•´ë‹¹í•˜ëŠ” ì„ íƒì§€ë¥¼ ê³¨ë¼ ì£¼ì„¸ìš”. 
                    ë³¸ ì—°êµ¬ëŠ” ì˜¨ë¼ì¸ìœ¼ë¡œ ì§„í–‰ë˜ë¯€ë¡œ, ì‘ë‹µì„ ì œì¶œí•˜ì‹œë©´ ë³¸ì¸ì€ ì „ìì  ë°©ì‹(e-consent)ìœ¼ë¡œ ì—°êµ¬ ì°¸ì—¬ ë° ê° ë™ì˜ í•­ëª©ì— ë™ì˜í•˜ë©°, 
                    ì´ì— ë”°ë¼ ì—°êµ¬ìê°€ ë³¸ ë™ì˜ì„œì˜ ë™ì˜ í•­ëª© ë° ì„œëª…ë€ì„ ë³¸ì¸ì„ ëŒ€ì‹ í•˜ì—¬ ê¸°ì¬í•˜ëŠ” ê²ƒì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
                </p>
            </div>
        `,
        html: `
            <div class="question-box">
                <!-- 1) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ -->
                <div class="consent-section-title">[ê°œì¸ì •ë³´ ìˆ˜ì§‘ì— ëŒ€í•œ ë™ì˜]</div>
                <p class="consent-text">ë³¸ì¸ì€ ê°œì¸ì •ë³´ ìˆ˜ì§‘ì— ëŒ€í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©°, ë³¸ ì—°êµ¬ì—ì„œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ì— ëŒ€í•˜ì—¬â€¦</p>
                <label style="display:block; margin-bottom:5px;">
                    <input type="radio" name="human_main_collect" value="ë™ì˜í•©ë‹ˆë‹¤" required>
                    â–¶ ë™ì˜í•©ë‹ˆë‹¤.
                </label>
                <label style="display:block;">
                    <input type="radio" name="human_main_collect" value="ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤">
                    â–¶ ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‹¤í—˜ ì°¸ì—¬ ë¶ˆê°€)
                </label>

                <!-- 2) ê°œì¸ì •ë³´ ì œê³µ ë²”ìœ„ -->
                <div class="consent-section-title">[ê°œì¸ì •ë³´ì˜ ì œê³µì— ê´€í•œ ì‚¬í•­]</div>
                <p class="consent-text">
                    (íƒ€ì—°êµ¬ìì—ê²Œ ê°œì¸ì •ë³´ ì œê³µì´ ìˆì„ ì‹œ) ë³¸ ì—°êµ¬ì—ì„œ ì°¸ì—¬í•¨ìœ¼ë¡œì¨ ìˆ˜ì§‘ë˜ëŠ” ê°œì¸ì •ë³´ëŠ” ë‚˜ì´, ì„±ë³„, ì¸ê³µì™€ìš° ì´ì‹ ë°©í–¥, ì¸ê³µì™€ìš° ì‚¬ìš© ê¸°ê°„, ìŒì•… ê²½í—˜ ì¢…ë¥˜ ë° ê¸°ê°„ì´ë©°, í•´ë‹¹ ì •ë³´ëŠ” ê·€í•˜ì˜ ë™ì˜ì— ë”°ë¼ ë³´ì¡´ ê¸°ê°„ë‚´ 2ì°¨ì  ì‚¬ìš©ì„ ìœ„í•´ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—°êµ¬ìëŠ” íƒ€ì—°êµ¬ìì—ê²Œ ê°œì¸ì •ë³´ì œê³µì„ ì œê³µí•˜ëŠ” ê²½ìš°ì—ëŠ” KAIST ìƒëª…ìœ¤ë¦¬ì‹¬ì˜ìœ„ì›íšŒì— ê°œì¸ì •ë³´ì œê³µì— ê´€í•˜ì—¬ ë³„ë„ ì‹¬ì˜ë¥¼ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.
                </p>
                <label style="display:block; margin-bottom:5px;">
                    <input type="radio" name="human_provide_scope" value="ìœ ì‚¬í•œ ì—°êµ¬ ë²”ìœ„ ì•ˆì—ì„œë§Œ ì œê³µ ë™ì˜" required>
                    â–¶ ìœ ì‚¬í•œ ì—°êµ¬ ë²”ìœ„ ì•ˆì—ì„œë§Œ ì œê³µí•˜ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤.
                </label>
                <label style="display:block; margin-bottom:5px;">
                    <input type="radio" name="human_provide_scope" value="í¬ê´„ì  ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œê³µ ë™ì˜">
                    â–¶ í¬ê´„ì  ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤.
                </label>
                <label style="display:block;">
                    <input type="radio" name="human_provide_scope" value="ì œê³µì— ë™ì˜í•˜ì§€ ì•ŠìŒ">
                    â–¶ ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‹¤í—˜ ì°¸ì—¬ ë¶ˆê°€)
                </label>

                <!-- 3) ê°œì¸ì‹ë³„ì •ë³´ í¬í•¨ ì—¬ë¶€ -->
                <div class="consent-section-title">[ê°œì¸ì‹ë³„ì •ë³´ í¬í•¨ ì—¬ë¶€ì— ëŒ€í•œ ë™ì˜]</div>
                <p class="consent-text">
                    ê·€í•˜ê°€ ê°œì¸ì •ë³´ì œê³µì— ëŒ€í•˜ì—¬ ë™ì˜ì‹œ, í•´ë‹¹ ì •ë³´ëŠ” ìµëª…í™”í•˜ì—¬ ì œ3ìì—ê²Œ ì œê³µë©ë‹ˆë‹¤. ë‹¤ë§Œ, ê·€í•˜ê°€ ê°œì¸ì‹ë³„ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì— ë™ì˜í•œ ê²½ìš°ì—ëŠ” ì˜ˆì™¸ë¡œ í•©ë‹ˆë‹¤.
                </p>
                <label style="display:block; margin-bottom:5px;">
                    <input type="radio" name="human_identifiable" value="ê°œì¸ì‹ë³„ì •ë³´ í¬í•¨ ë™ì˜" required>
                    â–¶ ê°œì¸ì‹ë³„ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì— ë™ì˜í•©ë‹ˆë‹¤.
                </label>
                <label style="display:block;">
                    <input type="radio" name="human_identifiable" value="ê°œì¸ì‹ë³„ì •ë³´ í¬í•¨ ë™ì˜í•˜ì§€ ì•ŠìŒ">
                    â–¶ ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‹¤í—˜ ì°¸ì—¬ ë¶ˆê°€)
                </label>

                <!-- 4) ìƒˆë¡œìš´ ì •ë³´ í†µë³´ ì—¬ë¶€ -->
                <div class="consent-section-title">[ì—°êµ¬ ê´€ë ¨ ìƒˆë¡œìš´ ì •ë³´ í†µë³´ ì—¬ë¶€]</div>
                <p class="consent-text">
                    ë³¸ ì—°êµ¬ì§„í–‰ ì¤‘ ë³¸ì¸ì—ê²Œ ì˜í–¥ì„ ì¤„ ìˆ˜ë„ ìˆëŠ” ìƒˆë¡œìš´ ì •ë³´ë¥¼ ì—°êµ¬ìê°€ íšë“ ì‹œ ê·¸ ë‚´ìš©ì„ í†µë³´ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <label style="display:block; margin-bottom:5px;">
                    <input type="radio" name="human_notify" value="í†µë³´ë¥¼ ì›í•¨" required>
                    â–¶ í†µë³´ë¥¼ ì›í•©ë‹ˆë‹¤.
                </label>
                <label style="display:block;">
                    <input type="radio" name="human_notify" value="í†µë³´ë¥¼ ì›ì¹˜ ì•ŠìŒ">
                    â–¶ í†µë³´ë¥¼ ì›ì¹˜ ì•ŠìŠµë‹ˆë‹¤.
                </label>

                <!-- 5) ì„œëª… ë° ê¸°ë³¸ ì •ë³´ ì…ë ¥ -->
                <div class="consent-section-title" style="margin-top:20px;">[ë³¸ì¸ í™•ì¸ ë° ì„œëª…]</div>
                <p class="consent-text">
                    ë³¸ì¸ì€ ì´ ë™ì˜ì„œë¥¼ ì½ê³  ì´í•´í•˜ì˜€ìœ¼ë©° ëª¨ë“  ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ì— ë³¸ì¸ì€ ìë°œì ìœ¼ë¡œ ë³¸ ì—°êµ¬ì— ì°¸ì—¬í•¨ì„ ì„œëª…ìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.
                </p>
                <p class="consent-text">
                    ë˜í•œ, ë³¸ì¸ì€ <br>
                    1. ë³¸ì¸ê³¼ ì—°êµ¬ì ë° KAIST ì‚¬ì´ì— ë³¸ì¸ì˜ ì—°êµ¬ ì°¸ì—¬ê²°ì •ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ì–´ë– í•œ ê´€ê³„ë„ ì—†ê³ , <br>
                    2. ìš”ì–‘ì› ê°™ì€ ìˆ˜ìš© ì‹œì„¤ì— ê±°ì£¼í•˜ê±°ë‚˜, ì¸ì§€ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆì§€ ì•„ë‹ˆí•˜ë©°, <br>
                    3. ë§Œì•½, ìœ„ì— ì—´ê±°í•œ 1, 2ì˜ ìƒí™©ì— í•´ë‹¹ë˜ëŠ” ê²½ìš° ìƒëª…ìœ¤ë¦¬ì‹¬ì˜ìœ„ì›íšŒ ê°„ì‚¬ì˜ ì…íšŒí•˜ì— ë³¸ ë™ì˜ì„œì— ëŒ€í•œ ì„¤ëª…ì„ ë“£ê³  ì•„ë˜ ì„œëª…ì„ í•˜ì˜€ìŒì„ í™•ì¸í•©ë‹ˆë‹¤.
                </p>

                <div class="consent-input-row">
                    <label>ì£¼ì†Œ (ë™ê¹Œì§€ë§Œ ì“°ì…”ë„ ë©ë‹ˆë‹¤) :</label>
                    <input type="text" name="human_addr" required>
                </div>
                <div class="consent-input-row">
                    <label>ì—°ë½ì²˜ :</label>
                    <input type="text" name="human_phone" required>
                </div>
                <div class="consent-input-row">
                    <label>ì„±ëª… :</label>
                    <input type="text" name="human_name" required>
                </div>
                <div class="consent-input-row">
                    <label>ì„œëª… ë˜ëŠ” ì¸ :</label>
                    <input type="text" name="human_sign" required>
                </div>
                <p class="consent-text" style="font-size:12px; margin-top:2px; color:#666;">
                    *í”¼í—˜ìê°€ ì§ì ‘ ì„œëª…í•  ìˆ˜ ì—†ëŠ” ì˜¨ë¼ì¸ ì‹¤í—˜ì´ë¯€ë¡œ, (ì„œëª… ë˜ëŠ” ì¸)ë€ ì˜¤ë¥¸ìª½ì— ë³¸ì¸ ì´ë¦„ì„ íƒ€ì´í•‘í•  ì‹œ ì—°êµ¬ìê°€ ëŒ€ë¦¬ ì„œëª…í•˜ëŠ” ê²ƒì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
                </p>
                <div class="consent-input-row">
                    <label>ë™ì˜ì¼ì :</label>
                    <input type="text" name="human_date" placeholder="ì˜ˆ: 20251203" required>
                </div>
            </div>
        `,
        button_label: "ë‹¤ìŒ (ì‚¬ë¡€ë¹„ ë™ì˜ì„œë¡œ ì´ë™)",
        on_finish: function(data){
            var resp = data.response;
            
            // í•„ìˆ˜ ë™ì˜ í•­ëª© ì²´í¬
            if(resp.human_main_collect.includes("ë™ì˜í•˜ì§€") || 
               resp.human_provide_scope.includes("ë™ì˜í•˜ì§€") || 
               resp.human_identifiable.includes("ë™ì˜í•˜ì§€")) {
                jsPsych.endExperiment("í•„ìˆ˜ ë™ì˜ í•­ëª©ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ì…”ì„œ, í–‰ë™ì‹¤í—˜ì— ì°¸ì—¬í•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì°¸ì—¬ ì˜ì‚¬ë¥¼ ê²€í† í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.");
            }
        }
    };
    timeline.push(consent_human);

    // 1-2. ë™ì˜ì„œ 2: ê°œì¸ì •ë³´ ìˆ˜ì§‘ ì´ìš© ë™ì˜ì„œ (ì‚¬ë¡€ë¹„)
    var consent_payment = {
        type: jsPsychSurveyHtmlForm,
        preamble: `
            <div class="question-box">
                <h1 class="main-title" style="text-align:center;">(ì‚¬ë¡€ë¹„ ì§€ê¸‰ ë“±)ì„ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš© ë™ì˜ì„œ</h1>
                <p class="consent-text">
                    ë‹¤ìŒì€ í–‰ë™ì‹¤í—˜ ì°¸ì—¬ì— ë”°ë¥¸ ì‚¬ë¡€ë¹„ ì§€ê¸‰ì„ ìœ„í•´ í•„ìš”í•œ 
                    <strong>ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš© ë™ì˜ì„œ</strong>ì…ë‹ˆë‹¤.<br>
                    ì•„ë˜ì˜ ë™ì˜ì„œ ì „ë¬¸(PDF íŒŒì¼)ì„ ìŠ¤í¬ë¡¤í•˜ì—¬ ëê¹Œì§€ ì½ì–´ì£¼ì„¸ìš”.
                </p>
                <div class="pdf-box">
                    <iframe src="documents/personal_info_consent.pdf"></iframe>
                </div>
                <p class="consent-text">
                    ì•„ë˜ëŠ” ë™ì˜ì„œ ì¤‘ <strong>í•µì‹¬ ì •ë³´</strong>ë¥¼ ìš”ì•½í•œ ê²ƒì…ë‹ˆë‹¤.
                    ë³¸ ì—°êµ¬ëŠ” ì˜¨ë¼ì¸ìœ¼ë¡œ ì§„í–‰ë˜ë¯€ë¡œ, ì‘ë‹µì„ ì œì¶œí•˜ì‹œë©´ ë³¸ì¸ì€ ì „ìì  ë°©ì‹(e-consent)ìœ¼ë¡œ ì—°êµ¬ ì°¸ì—¬ ë° ê° ë™ì˜ í•­ëª©ì— ë™ì˜í•˜ë©°, 
                    ì´ì— ë”°ë¼ ì—°êµ¬ìê°€ ë³¸ ë™ì˜ì„œì˜ ë™ì˜ í•­ëª© ë° ì„œëª…ë€ì„ ë³¸ì¸ì„ ëŒ€ì‹ í•˜ì—¬ ê¸°ì¬í•˜ëŠ” ê²ƒì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
                </p>
                <ul class="consent-text" style="list-style-position: inside;">
                    <li>ì‚¬ë¡€ë¹„ : <strong>10,000ì› (ì‹¤í—˜ ì¢…ë£Œ í›„ 4~6ì£¼ ì´ë‚´ ì§€ê¸‰)</strong></li>
                </ul>
                <p class="consent-text">
                    ì‚¬ë¡€ë¹„ ì§€ê¸‰ì„ ìœ„í•´ ìˆ˜ì§‘ë˜ëŠ” ê°œì¸ì •ë³´ì˜ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.<br>
                    ì„±ëª…, ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸(ì™¸ë¶€ì¸ì˜ ê²½ìš° 13ìë¦¬), ì—°ë½ì²˜, ì€í–‰ëª… ë° ê³„ì¢Œë²ˆí˜¸, ì£¼ì†Œ(ë™ê¹Œì§€) ë“±
                </p>
                <p class="consent-text">
                    <strong>â–£ ë¯¸ë™ì˜ì‹œ ë¶ˆì´ìµ ë‚´ìš© :</strong> ì—°êµ¬ ì°¸ì—¬ì— ë”°ë¥¸ ì‚¬ë¡€ë¹„ë¥¼ ì§€ê¸‰ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                </p>
            </div>
        `,
        html: `
            <div class="question-box">
                <div class="consent-section-title">[ì‚¬ë¡€ë¹„ ì§€ê¸‰ì„ ìœ„í•œ ê°œì¸ì •ë³´ ì…ë ¥]</div>

                <div class="consent-input-row">
                    <label>ì„±ëª… :</label>
                    <input type="text" name="pay_name" required>
                </div>
                <div class="consent-input-row">
                    <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ :</label>
                    <input type="text" name="pay_rrn" required>
                </div>
                <p class="consent-text" style="margin-top:2px; margin-left:190px; font-size:12px; color:#666;">
                    (KAIST ë‚´ë¶€ì¸ì˜ ê²½ìš° ì• 7ìë¦¬, ì™¸ë¶€ì¸ì˜ ê²½ìš° 13ìë¦¬ ëª¨ë‘ í•„ìš”)
                </p>

                <div class="consent-input-row">
                    <label>ì—°ë½ì²˜ :</label>
                    <input type="text" name="pay_phone" required>
                </div>
                <div class="consent-input-row">
                    <label>ì€í–‰ëª…, ê³„ì¢Œë²ˆí˜¸ :</label>
                    <input type="text" name="pay_bank_account" required>
                </div>
                <div class="consent-input-row">
                    <label>ì£¼ì†Œ (ë™ê¹Œì§€ë§Œ ì“°ì…”ë„ ë©ë‹ˆë‹¤) :</label>
                    <input type="text" name="pay_addr" required>
                </div>

                <div class="consent-section-title" style="margin-top:14px;">[ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš©ì— ëŒ€í•œ ë™ì˜]</div>
                <p class="consent-text">
                    ë³¸ì¸ì€ ìœ„ì™€ ê°™ì´ ë³¸ì¸ì˜ ê°œì¸ì •ë³´ì— ëŒ€í•œ ìˆ˜ì§‘ ë° í™œìš©ì— ëŒ€í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©°,
                    ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™œìš©ì— ëŒ€í•˜ì—¬â€¦
                </p>
                <label style="display:block; margin-bottom:5px;">
                    <input type="radio" name="payment_main_consent" value="ë™ì˜í•©ë‹ˆë‹¤" required>
                    â–¶ ë™ì˜í•©ë‹ˆë‹¤.
                </label>
                <label style="display:block;">
                    <input type="radio" name="payment_main_consent" value="ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤">
                    â–¶ ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‹¤í—˜ ì°¸ì—¬ ë¶ˆê°€)
                </label>

                <div class="consent-section-title" style="margin-top:14px;">[ë™ì˜ì¼ì ë° ì„œëª…]</div>
                <div class="consent-input-row">
                    <label>ë™ì˜ì¼ì (20 . . . ) :</label>
                    <input type="text" name="pay_date" placeholder="ì˜ˆ: 20251203" required>
                </div>
                <div class="consent-input-row">
                    <label>í”¼í—˜ì(ë™ì˜ì) ì„±ëª… :</label>
                    <input type="text" name="pay_sign_name" required>
                </div>
                <div class="consent-input-row">
                    <label>ì„œëª… :</label>
                    <input type="text" name="pay_sign" required>
                </div>
                <p class="consent-text" style="font-size:12px; margin-top:2px; color:#666;">
                    *í”¼í—˜ìê°€ ì§ì ‘ ì„œëª…í•  ìˆ˜ ì—†ëŠ” ì˜¨ë¼ì¸ ì‹¤í—˜ì´ë¯€ë¡œ, (ì„œëª…)ë€ ì˜¤ë¥¸ìª½ì— ë³¸ì¸ ì´ë¦„ì„ íƒ€ì´í•‘í•  ì‹œ
                    ì—°êµ¬ìê°€ ëŒ€ë¦¬ ì„œëª…í•˜ëŠ” ê²ƒì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
                </p>
            </div>
        `,
        button_label: "ë‹¤ìŒ (ê¸°ì´ˆ ì •ë³´ ì…ë ¥)",
        on_finish: function(data){
            var resp = data.response;
            if(resp.payment_main_consent.startsWith("ë™ì˜í•˜ì§€")){
                jsPsych.endExperiment("ì‚¬ë¡€ë¹„ ì§€ê¸‰ì„ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·í™œìš©ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ì…”ì„œ, ë³¸ ì˜¨ë¼ì¸ ì‹¤í—˜ì— ì°¸ì—¬í•˜ì‹¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì°¸ì—¬ ì˜ì‚¬ë¥¼ ê²€í† í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.");
            }
        }
    };
    timeline.push(consent_payment);


    // --- Page 1: ê¸°ë³¸ ì¸ì ì‚¬í•­ ---
    var page_1_demographics = {
        type: jsPsychSurveyHtmlForm,
        preamble: '<div class="question-box" style="text-align:center;"><h3>ê¸°ë³¸ ì¸ì ì‚¬í•­</h3><p>ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p></div>',
        html: `
            <div class="question-box">
                <label class="question-label">ì´ë¦„</label>
                <input type="text" name="name" required style="margin-bottom: 15px; width: 100%; box-sizing: border-box;"><br>
                
                <label class="question-label">ë§Œ ë‚˜ì´</label>
                <input type="number" name="age" class="small-input" required style="margin-bottom: 15px;"> ì„¸<br>
                
                <label class="question-label">ìƒë…„ì›”ì¼ (ì˜ˆ: 1995.02.22)</label>
                <input type="text" name="dob" placeholder="YYYY.MM.DD" required style="margin-bottom: 15px; width: 100%; box-sizing: border-box;"><br>
                
                <label class="question-label">ì„±ë³„</label>
                <select name="gender" required style="width: 100%;">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="male">ë‚¨ì„±</option>
                    <option value="female">ì—¬ì„±</option>
                </select>
            </div>
        `,
        button_label: 'ë‹¤ìŒ'
    };
    timeline.push(page_1_demographics);

    // --- Page 2: ì—°êµ¬ ì°¸ì—¬ì ì ê²©ì„± ê²€ì¦í‘œ ---
    var page_2_eligibility = {
        type: jsPsychSurveyHtmlForm,
        preamble: '<div class="question-box" style="text-align:center;"><h3>ì—°êµ¬ ì°¸ì—¬ì ì ê²©ì„± ê²€ì¦í‘œ</h3></div>',
        html: `
            <div class="question-box">
                <p class="question-label">1. ë§Œ 20ì„¸ ì´ìƒ 64ì„¸ ì´í•˜ì…ë‹ˆê¹Œ?</p>
                <label><input type="radio" name="eligibility_age" value="yes" required> ì˜ˆ</label>
                <label><input type="radio" name="eligibility_age" value="no" style="margin-left: 20px;"> ì•„ë‹ˆì˜¤</label>
                <br><br>

                <p class="question-label">2. ì²­ë ¥ ë•Œë¬¸ì— ì¼ìƒ ìƒí™œì— ì¥ì• ë¥¼ ê²ªìŠµë‹ˆê¹Œ?</p>
                <label><input type="radio" name="eligibility_hearing" value="yes" required> ì˜ˆ</label>
                <label><input type="radio" name="eligibility_hearing" value="no" style="margin-left: 20px;"> ì•„ë‹ˆì˜¤</label>
                <br><br>

                <p class="question-label">3. ì† ì›€ì§ì„ì˜ ë¶ˆí¸í•¨ ë•Œë¬¸ì— ì¼ìƒ ìƒí™œì— ì¥ì• ë¥¼ ê²ªìŠµë‹ˆê¹Œ?</p>
                <label><input type="radio" name="eligibility_hand" value="yes" required> ì˜ˆ</label>
                <label><input type="radio" name="eligibility_hand" value="no" style="margin-left: 20px;"> ì•„ë‹ˆì˜¤</label>
                <br><br>

                <p class="question-label">4. ê³¼ê±° ë˜ëŠ” í˜„ì¬ ì‹ ê²½/ì •ì‹  ê´€ë ¨ ì§ˆí™˜ì„ ê²ªì€ ì ì´ ìˆìŠµë‹ˆê¹Œ?</p>
                <label><input type="radio" name="eligibility_neuro" value="yes" required> ì˜ˆ</label>
                <label><input type="radio" name="eligibility_neuro" value="no" style="margin-left: 20px;"> ì•„ë‹ˆì˜¤</label>
                <br><br>

                <p class="question-label">5. ì‹¤í—˜ ì°¸ì—¬ ë™ì˜ì„œì— ì„œëª…í•˜ì˜€ìŠµë‹ˆê¹Œ?<br><span style="font-weight:normal; font-size:0.9em;">(ì—°êµ¬ ì‹œì‘ ì „ì— ë°˜ë“œì‹œ ì„ í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤!)</span></p>
                <label><input type="radio" name="consent" value="yes" required> ì˜ˆ (ë™ì˜í•©ë‹ˆë‹¤)</label>
                <label><input type="radio" name="consent" value="no" style="margin-left: 20px;"> ì•„ë‹ˆì˜¤</label>
            </div>
        `,
        button_label: 'ë‹¤ìŒ'
    };
    timeline.push(page_2_eligibility);

    // --- Page 3: ìŒì•… ë°°ê²½ ê´€ë ¨ ì„¤ë¬¸ ---
    var page_3_music_bg = {
        type: jsPsychSurveyHtmlForm,
        preamble: '<div class="question-box" style="text-align:center;"><h3>ìŒì•… ë°°ê²½ ê´€ë ¨ ì„¤ë¬¸</h3></div>',
        html: `
            <div class="question-box">
                <p class="question-label">1. ê·€í•˜ì˜ ìŒì•… ì „ê³µ ì—¬ë¶€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                <label><input type="radio" name="music_major" value="yes" required> ì˜ˆ</label>
                <label><input type="radio" name="music_major" value="no" style="margin-left: 10px;"> ì•„ë‹ˆì˜¤</label>
                <br><br>

                <p class="question-label">2. í˜„ì¬ ë‹¤ë£° ìˆ˜ ìˆëŠ” ì•…ê¸°(ì„±ì•…/ë³´ì»¬/ì†Œë¦¬ í¬í•¨)ëŠ” ë¬´ì—‡ì´ ìˆë‚˜ìš”? (ì „ë¶€ ë‹µë³€)</p>
                <input type="text" name="instruments" style="width: 100%;" placeholder="ì˜ˆ: í”¼ì•„ë…¸, ê¸°íƒ€, ë³´ì»¬ ë“±">
                <br><br>

                <p class="question-label">3. ì§€ê¸ˆê¹Œì§€ ì•…ê¸°(ì„±ì•…/ë³´ì»¬/ì†Œë¦¬ í¬í•¨)ë¥¼ ì „ë¬¸ì ìœ¼ë¡œ ë°°ìš°ê±°ë‚˜ í›ˆë ¨ë°›ì€ ê¸°ê°„ì€ ì´ ëª‡ ë…„ì¸ê°€ìš”?</p>
                <p style="font-size: 0.9em; color: gray;">(ì „ë¬¸ì  í›ˆë ¨ì˜ ê¸°ì¤€: ì˜ˆìˆ  ì¤‘ê³  ë˜ëŠ” ëŒ€í•™ ì „ê³µ ê³¼ì •, í•™ì›, ë ˆìŠ¨ í¬í•¨)</p>
                <input type="number" name="training_years" class="small-input" required> ë…„
            </div>
        `,
        button_label: 'ë‹¤ìŒ'
    };
    timeline.push(page_3_music_bg);

    // --- Page 4: êµ­ì•… ë° ê·¸ë£¨ë¸Œ ì¸ì‹ ---
    function createLikertHTML(questionText, name, leftLabel, rightLabel) {
        let optionsHTML = '';
        for (let i = 1; i <= 7; i++) {
            optionsHTML += `
                <div class="likert-option">
                    <span class="likert-num">${i}</span>
                    <input type="radio" name="${name}" value="${i}" required>
                </div>
            `;
        }
        return `
            <div class="question-box">
                <label class="question-text">${questionText}</label>
                <div class="likert-container">
                    <div class="likert-label-side">${leftLabel}</div>
                    <div class="likert-options-group">
                        ${optionsHTML}
                    </div>
                    <div class="likert-label-side">${rightLabel}</div>
                </div>
            </div>
        `;
    }

    var page_4_groove_survey = {
        type: jsPsychSurveyHtmlForm,
        preamble: '<div class="question-box" style="text-align:center;"><h3>ìŒì•…ì  ì„ í˜¸ë„ ì¡°ì‚¬</h3></div>',
        html: `
            ${createLikertHTML("1. êµ­ì•…(í•œêµ­ ì „í†µ ìŒì•…)ì— ëŒ€í•´ì„œ ì–¼ë§ˆë‚˜ ì¹œìˆ™í•œê°€ìš”?", "gugak_familiarity", "ì „í˜€ ì¹œìˆ™í•˜ì§€ ì•ŠìŒ", "ë§¤ìš° ì¹œìˆ™í•¨")}
            ${createLikertHTML("2. í‰ì†Œ êµ­ì•…ì„ ì–¼ë§ˆë‚˜ ìì£¼ ë“£ë‚˜ìš”?", "gugak_freq", "ì „í˜€ ì•ˆ ë“¤ìŒ", "ë§¤ìš° ìì£¼ ë“¤ìŒ")}
            ${createLikertHTML("3. êµ­ì•…ì„ ì–¼ë§ˆë‚˜ ì¢‹ì•„í•˜ë‚˜ìš”?", "gugak_like", "ì „í˜€ ì¢‹ì•„í•˜ì§€ ì•ŠìŒ", "ë§¤ìš° ì¢‹ì•„í•¨")}
            ${createLikertHTML("4. í‰ì†Œ ê·¸ë£¨ë¸Œ ê¸°ë°˜ ìŒì•…ì„ ì–¼ë§ˆë‚˜ ìì£¼ ë“£ë‚˜ìš”?<br><span style='font-size:0.8em; font-weight:normal;'>(ì¬ì¦ˆ, í‘í¬, ì†Œìš¸, í™í•©, EDM, ë ˆê²Œ, ì•Œì•¤ë¹„ ë“±)</span>", "groove_freq", "ì „í˜€ ì•ˆ ë“¤ìŒ", "ë§¤ìš° ìì£¼ ë“¤ìŒ")}
            ${createLikertHTML("5. ê·¸ë£¨ë¸Œ ê¸°ë°˜ ìŒì•…ì„ ì–¼ë§ˆë‚˜ ì¢‹ì•„í•˜ë‚˜ìš”?", "groove_like", "ì „í˜€ ì¢‹ì•„í•˜ì§€ ì•ŠìŒ", "ë§¤ìš° ì¢‹ì•„í•¨")}
        `,
        button_label: 'ë‹¤ìŒ'
    };
    timeline.push(page_4_groove_survey);

    var page_4_groove_def = {
        type: jsPsychSurveyHtmlForm,
        html: `
            <div class="question-box">
                <label class="question-text">ë³¸ì¸ì´ ìƒê°í•˜ëŠ” â€˜ê·¸ë£¨ë¸Œ(Groove)â€™ì˜ ì •ì˜ë¥¼ ììœ ë¡­ê²Œ ì„œìˆ í•´ì£¼ì„¸ìš”.</label>
                <textarea name="groove_definition" rows="10" required></textarea>
            </div>
        `,
        button_label: 'ë‹¤ìŒ'
    };
    timeline.push(page_4_groove_def);


    // --- Page 5: ì‹¤í—˜ ì‹œì‘ ì•ˆë‚´ë¬¸ (ì—°ìŠµ ê´€ë ¨ ë¬¸êµ¬ ì œê±°ë¨) ---
    var page_5_instruction = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <div class="question-box">
                <h2>ì‹¤í—˜ ì‹œì‘ ì•ˆë‚´</h2>
                <div class="instruction-text" style="font-size: 1.1em;">
                    <p>ì§€ê¸ˆë¶€í„° ì²­ì·¨ ì‹¤í—˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.</p>
                    <p style="color: #d9534f; font-weight: bold;">ì¡°ìš©í•œ ì¥ì†Œì—ì„œ ì´ì–´í°ì´ë‚˜ í—¤ë“œí°ì„ ì°©ìš©í•´ì£¼ì„¸ìš”!!</p>
                    <br>
                    <p><b>ì‹¤í—˜ ë°©ë²•:</b></p>
                    <p>1. ê° í™”ë©´ì—ì„œ <b>ì¬ìƒ ë²„íŠ¼(â–¶)</b>ì„ ëˆŒëŸ¬ ìŒì•…ì„ ë“¤ì–´ì£¼ì„¸ìš”.</p>
                    <p>2. ìŒì•…ì€ ì›í•˜ëŠ” ë§Œí¼ ë°˜ë³µí•´ì„œ ë“¤ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <p>3. ìŒì•…ì„ ë“¤ìœ¼ë©° ì•„ë˜ 5ê°€ì§€ ì§ˆë¬¸ì— ëŒ€í•´ ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬ ì‘ë‹µí•´ ì£¼ì„¸ìš”.</p>
                    <br>
                    <p>ì¤€ë¹„ê°€ ë˜ì…¨ë‹¤ë©´ ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                </div>
            </div>
        `,
        choices: ['ì‹¤í—˜ ì‹œì‘í•˜ê¸°']
    };
    timeline.push(page_5_instruction);

    // --- ì‹œí–‰(Trial) ìƒì„± í•¨ìˆ˜ ---
    var create_slider_trial = function(timeline_vars) {
        return {
            type: jsPsychSurveyHtmlForm,
            preamble: function() {
                var current_audio = jsPsych.timelineVariable('stimulus');
                
                // ì§„í–‰ ìƒí™© ê³„ì‚° (task: 'rating'ìœ¼ë¡œ ê¸°ë¡ëœ ë°ì´í„° ê°œìˆ˜ + 1)
                var completed_trials = jsPsych.data.get().filter({task: 'rating'}).count();
                var total_trials = main_stimuli.length;
                var current_trial_num = completed_trials + 1;

                return `
                    <div class="progress-text">ì§„í–‰ë¥ : ${current_trial_num} / ${total_trials}</div>
                    <div class="audio-section">
                        <p style="margin-bottom:10px; font-weight:bold; color:#555;">ğŸ§ ì•„ë˜ ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¦¬ë“¬ì„ ë“¤ì–´ë³´ì„¸ìš”</p>
                        <audio controls controlsList="nodownload" src="${current_audio}" style="width: 100%; max-width: 400px;"></audio>
                    </div>
                `;
            },
            html: `
                <!-- 1. ì›€ì§ì„ ìš•êµ¬ (êµ¬ 4ë²ˆ) -->
                <div class="question-box">
                    <label class="question-text">1. ì´ ë¦¬ë“¬/ì¥ë‹¨ì´ ì–¼ë§ˆë‚˜ ëª¸ì„ ì›€ì§ì´ê³  ì‹¶ê²Œ í–ˆë‚˜ìš”?</label>
                    <div class="slider-wrapper">
                        <input type="range" name="move_desire" min="0" max="100" value="50" step="1">
                        <div class="slider-labels-container">
                            <div class="slider-label-item slider-label-left">
                                <span class="slider-num-bold">0</span>
                                <span>ì „í˜€ ê·¸ë ‡ì§€ ì•ŠìŒ</span> 
                            </div>
                            <div class="slider-label-item slider-label-right">
                                <span class="slider-num-bold">100</span>
                                <span>ë§¤ìš° ê·¸ëŸ¬í•¨</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. ì¦ê±°ì›€ (êµ¬ 5ë²ˆ) -->
                <div class="question-box">
                    <label class="question-text">2. ì´ ë¦¬ë“¬/ì¥ë‹¨ì„ ë“¤ìœ¼ë©° ì–¼ë§ˆë‚˜ ì¦ê±°ì›€ì„ ëŠê¼ˆìŠµë‹ˆê¹Œ?</label>
                    <div class="slider-wrapper">
                        <input type="range" name="enjoyment" min="0" max="100" value="50" step="1">
                        <div class="slider-labels-container">
                            <div class="slider-label-item slider-label-left">
                                <span class="slider-num-bold">0</span>
                                <span>ì „í˜€ ì¦ê²ì§€ ì•ŠìŒ</span>
                            </div>
                            <div class="slider-label-item slider-label-right">
                                <span class="slider-num-bold">100</span>
                                <span>ë§¤ìš° ì¦ê±°ì›€</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. ë³µì¡ì„± (êµ¬ 1ë²ˆ) -->
                <div class="question-box">
                    <label class="question-text">3. ì´ ë¦¬ë“¬/ì¥ë‹¨ì´ ì–¼ë§ˆë‚˜ ë³µì¡í•˜ê²Œ ëŠê»´ì¡Œë‚˜ìš”?</label>
                    <div class="slider-wrapper">
                        <input type="range" name="complexity" min="0" max="100" value="50" step="1">
                        <div class="slider-labels-container">
                            <div class="slider-label-item slider-label-left">
                                <span class="slider-num-bold">0</span>
                                <span>ë§¤ìš° ë‹¨ìˆœí•¨</span>
                            </div>
                            <div class="slider-label-item slider-label-right">
                                <span class="slider-num-bold">100</span>
                                <span>ë§¤ìš° ë³µì¡í•¨</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. ì˜ˆì¸¡ ê°€ëŠ¥ì„± (êµ¬ 2ë²ˆ) -->
                <div class="question-box">
                    <label class="question-text">4. ì—°ì£¼ë˜ëŠ” íƒ€ì´ë°ì„ ì–¼ë§ˆë‚˜ ì˜ˆì¸¡í•  ìˆ˜ ìˆì—ˆë‚˜ìš”?</label>
                    <div class="slider-wrapper">
                        <input type="range" name="predictability" min="0" max="100" value="50" step="1">
                        <div class="slider-labels-container">
                            <div class="slider-label-item slider-label-left">
                                <span class="slider-num-bold">0</span>
                                <span>ì „í˜€ ì˜ˆì¸¡ ë¶ˆê°€</span>
                            </div>
                            <div class="slider-label-item slider-label-right">
                                <span class="slider-num-bold">100</span>
                                <span>ë§¤ìš° ì‰½ê²Œ ì˜ˆì¸¡</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. ì›€ì§ì„ ìš©ì´ì„± (êµ¬ 3ë²ˆ) -->
                <div class="question-box">
                    <label class="question-text">5. ì´ ë¦¬ë“¬/ì¥ë‹¨ì— ë§ì¶° ëª¸ì„ ì›€ì§ì´ëŠ” ê²ƒì´ ì–¼ë§ˆë‚˜ ì‰¬ì› ë‚˜ìš”?</label>
                    <div class="slider-wrapper">
                        <input type="range" name="move_ease" min="0" max="100" value="50" step="1">
                        <div class="slider-labels-container">
                            <div class="slider-label-item slider-label-left">
                                <span class="slider-num-bold">0</span>
                                <span>ë§¤ìš° ì–´ë ¤ì›€</span>
                            </div>
                            <div class="slider-label-item slider-label-right">
                                <span class="slider-num-bold">100</span>
                                <span>ë§¤ìš° ì‰¬ì›€</span>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            button_label: 'ë‹¤ìŒ',
            data: {
                task: 'rating',
                stim_type: jsPsych.timelineVariable('type'),
                stim_file: jsPsych.timelineVariable('stimulus')
            },
            on_load: function() {
                window.scrollTo(0,0);
            }
        };
    };

    // --- ë³¸ ì‹¤í—˜(Main) ë¸”ë¡ ---
    var main_procedure = {
        timeline: [create_slider_trial(main_stimuli)],
        timeline_variables: main_stimuli,
        randomize_order: true
    };
    timeline.push(main_procedure);

    // [ì¤‘ìš”] 5. DataPipe ì €ì¥ ë‹¨ê³„
    const save_data = {
        type: jsPsychPipe,
        action: "save",
        experiment_id: "9h8uHWnmjGTc", // â˜… ì‚¬ìš©ìë¶„ì˜ DataPipe ì‹¤í—˜ IDë¡œ ë³€ê²½ í•„ìš” â˜…
        filename: filename,
        // [ìˆ˜ì •] OSF ì €ì¥ ì‹œ í•œê¸€ ê¹¨ì§ ë°©ì§€ë¥¼ ìœ„í•´ BOM(\uFEFF) ë¬¸ì ì¶”ê°€
        data_string: () => "\uFEFF" + jsPsych.data.get().csv()
    };
    timeline.push(save_data);

    // --- Page 9: ì¢…ë£Œ ---
    var end_experiment = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <div class="question-box" style="text-align:center;">
                <h2>ì‹¤í—˜ì´ ëª¨ë‘ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</h2>
                <p>ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <p>ì°¸ì—¬í•´ ì£¼ì…”ì„œ ëŒ€ë‹¨íˆ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                <p>ì´ì œ ì°½ì„ ë‹«ìœ¼ì…”ë„ ë©ë‹ˆë‹¤.</p>
            </div>
        `,
        choices: ['ì¢…ë£Œ']
    };
    timeline.push(end_experiment);

    // 4. ì‹¤í—˜ ì‹œì‘
    jsPsych.run(timeline);

</script>
</body>
</html>
